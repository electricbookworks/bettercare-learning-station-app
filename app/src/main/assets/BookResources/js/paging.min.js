// init paging parameters
var last_pos = 0;
var page = 0;
var pages = null;
var document_size = null;
var page_size = 980;
var page_speed = 200;
var page_padding = 4;
var page_pos = 0;
var scrolling = false;
var anchor_pos = 0;
var isFixing = false;


/*
 * bind GORGEOUS scroll event to document element
 */
function paging() {
    // get current position
    shouldContinue = true;

    var cur_pos = $(document).scrollLeft();

    if (cur_pos < page_padding) {
        isFixing = true;
        cur_pos = page_padding;
        last_post = page_padding;
        page_pos = page_padding;
        shouldContinue = false;
        $('body').animate({
            scrollLeft: cur_pos
        }, {
            duration: 1,
            complete: function() {
                isFixing = false;
            }
        });

    }
    var nextPage = ((page) * page_size) + page_size + page_padding;

    if (cur_pos > nextPage) {

       var handler = function() {
                preventDefault();
        };
        $(document).bind('touchstart', handler);
        isFixing = true;
        cur_pos = nextPage;
        last_pos = nextPage;
        page_pos = nextPage;
        shouldContinue = false;
        $('body').animate({
            scrollLeft: nextPage
        }, {
            duration: 1,
            complete: function() {
                $(document).unbind('touchstart', handler);
                isFixing = false;
            }
        });

    }

    if (!isFixing && shouldContinue) {

        // stop all scrolling if page limit is reached
        if (cur_pos == page_pos) {
            scrolling = false;

        }

        // for right paging, over threshold
        if (!scrolling && last_pos < cur_pos) {
            // set lastPage to next page position
             document_size = jQuery(document).width();
             pages = Math.floor(jQuery(document).width() / (page_size+page_padding));
             if(page == pages-1)
             {
                  page_pos = jQuery(document).width() - page_size;
             }
             else
             {
                  page_pos = (page * page_size) + page_size + page_padding;
             }
            // set last position to next page
            scrolling = true;
            // scroll right one page and increment page number
            last_pos = page_pos;
            $('body').animate({
                scrollLeft: page_pos
            }, {
                duration: page_speed,
                complete: function() {
                    page++;
                }
            });
            return;
        }

        // for left paging, over threshold
        if (!scrolling && last_pos > cur_pos) {
            // set lastPage to previous page position
            page_pos = (page * page_size) - page_size + page_padding;
            // set last position to next page
            scrolling = true;
            last_pos = page_pos;
            // scroll right one page and decrement page number
            $('body').animate({
                scrollLeft: page_pos
            }, {
                duration: page_speed,
                complete: function() {
                    page--;
                }
            });
            return;
        }
    }

}

// init function to bind scroll event
$(document).ready(function() {
    $(window).scroll(paging);
    document_size = jQuery(document).width();
    pages = Math.floor(jQuery(document).width() / page_size);
});